<!-- carrousel.html -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ cidade.nome }} - Carrossel de Mídias</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .carousel-item video, .carousel-item img {
            max-height: 70vh;
            object-fit: contain;
            background: #000;
        }
        
        .carousel-caption {
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
            padding: 15px;
        }
        
        .media-counter {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            z-index: 10;
        }
        
        .media-type-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="container-fluid p-0">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center p-3 bg-light">
                    <h2 class="mb-0">{{ cidade.nome }}, {{ cidade.estado }}</h2>
                    <a href="{% url 'home' %}" class="btn btn-secondary">Voltar</a>
                </div>
            </div>
        </div>
        
        {% if medias %}
        <div class="row">
            <div class="col-12 position-relative">
                <!-- Contador de mídias -->
                <div class="media-counter">
                    <span id="current-slide">1</span> / {{ medias.count }}
                </div>
                
                <div id="mediaCarousel" class="carousel slide" data-bs-ride="false">
                    <div class="carousel-inner">
                        {% for media in medias %}
                        <div class="carousel-item {% if forloop.first %}active{% endif %}" data-slide-number="{{ forloop.counter }}">
                            <!-- Badge do tipo de mídia -->
                            <div class="media-type-badge">
                                {% if media.is_video %}
                                    <span class="badge bg-danger">
                                        <i class="fas fa-video"></i> Vídeo
                                    </span>
                                {% else %}
                                    <span class="badge bg-primary">
                                        <i class="fas fa-image"></i> Foto
                                    </span>
                                {% endif %}
                            </div>
                            
                            {% if media.is_video %}
                                <video class="d-block w-100" controls preload="metadata" data-slide="{{ forloop.counter }}">
                                    <source src="{{ media.arquivo.url }}" type="video/mp4">
                                    Seu navegador não suporta vídeos.
                                </video>
                            {% else %}
                                <img src="{{ media.arquivo.url }}" class="d-block w-100" alt="{{ media.titulo }}" loading="lazy">
                            {% endif %}
                            
                            <div class="carousel-caption d-none d-md-block">
                                <h5>{{ media.titulo }}</h5>
                                {% if media.descricao %}
                                    <p>{{ media.descricao|truncatewords:20 }}</p>
                                {% endif %}
                                <small class="text-light">
                                    <i class="fas fa-calendar"></i> 
                                    {{ media.data_upload|date:"d/m/Y H:i" }}
                                </small>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Controles do carrossel -->
                    {% if medias.count > 1 %}
                    <button class="carousel-control-prev" type="button" data-bs-target="#mediaCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                        <span class="visually-hidden">Anterior</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#mediaCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                        <span class="visually-hidden">Próximo</span>
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Thumbnails (opcional) -->
        {% if medias.count > 1 %}
        <div class="row mt-3">
            <div class="col-12">
                <div class="d-flex justify-content-center flex-wrap gap-2 p-3">
                    {% for media in medias %}
                    <button type="button" data-bs-target="#mediaCarousel" data-bs-slide-to="{{ forloop.counter0 }}" 
                            class="btn btn-outline-secondary btn-sm {% if forloop.first %}active{% endif %}"
                            style="max-width: 80px; height: 50px; overflow: hidden;">
                        {% if media.is_video %}
                            <i class="fas fa-play"></i>
                        {% else %}
                            <img src="{{ media.arquivo.url }}" style="width: 100%; height: 100%; object-fit: cover;">
                        {% endif %}
                    </button>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
        
        {% else %}
        <div class="row">
            <div class="col-12 text-center p-5">
                <h3>Nenhuma mídia encontrada</h3>
                <p class="text-muted">Esta cidade ainda não possui fotos ou vídeos cadastrados.</p>
                <a href="{% url 'cadastrar_media' %}" class="btn btn-primary">Adicionar Mídia</a>
            </div>
        </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/your-fontawesome-kit.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const carousel = document.getElementById('mediaCarousel');
            const currentSlideSpan = document.getElementById('current-slide');
            const videos = carousel.querySelectorAll('video');
            
            // Atualizar contador quando slide muda
            carousel.addEventListener('slide.bs.carousel', function (e) {
                const slideNumber = e.to + 1;
                currentSlideSpan.textContent = slideNumber;
                
                // Pausar todos os vídeos quando slide muda
                videos.forEach(video => {
                    video.pause();
                });
            });
            
            // Pausar vídeo quando sair do slide
            carousel.addEventListener('slid.bs.carousel', function (e) {
                const activeSlide = carousel.querySelector('.carousel-item.active');
                const activeVideo = activeSlide.querySelector('video');
                
                if (activeVideo) {
                    // Opcional: reproduzir automaticamente o vídeo do slide ativo
                    // activeVideo.play();
                }
            });
        });
    </script>
</body>
</html>